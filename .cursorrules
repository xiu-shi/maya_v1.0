# Maya Digital Twin - Cursor Development Rules
**Last Updated**: January 18, 2026  
**Version**: 1.0

## Project Context
This is Maya, Janet Xiu Shi's digital twin - a ChatGPT-like interface powered by AI Builders API. The project includes a Node.js/Express backend and a vanilla HTML/CSS/JS frontend.

## Timezone & Timestamps
**CRITICAL**: User is GMT timezone based. Always check the Mac's local system time before updating timestamps in files or logs.
- **Command to check time**: `date` or `date +"%Y-%m-%d %H:%M:%S %Z"`
- **Format**: Use "HH:MM GMT" format (e.g., "20:03 GMT")
- **Always verify**: Run `date` command before updating any timestamps
- **Never assume**: Do not use future times or estimated times - always use actual system time
- **Example**: If system shows "Sun Jan 11 20:03:18 GMT 2026", use "January 11, 2026, 20:03 GMT"

## Response Guidelines (for Maya)
When working on Maya's system prompt, response handling, or KB integration:
- Responses must be 100-250 words (prefer 150 words for simple questions)
- Use bullet points for lists (3-5 items max)
- Be conversational and friendly
- Never include internal reasoning or thinking process
- Always mention Janet's expertise areas when relevant (AI security, digital transformation, education)
- Direct users to Contact Form if more details are needed

## Knowledge Base Structure
- Documents in `Maya/knowledge/docs/` organized by category:
  - `bio/` - Biography and background
  - `expertise/` - AI security, digital transformation, education
  - `experience/` - Workday, Huawei, IADT, Lakera
  - `case-studies/` - Specific projects
  - `context/` - Irish market, speaking engagements
- High-priority docs: bio, main expertise areas
- PDFs stored in `Maya/knowledge/pdfs/` (gitignored)
- Google Docs referenced via markdown files in `docs/google-docs/`

## Code Style
- Use ES modules (import/export) - no CommonJS require()
- Follow existing error handling patterns with try/catch
- Log errors with full context using logger.js
- Use async/await consistently, not callbacks
- Use descriptive variable names
- Add JSDoc comments for functions

## Security - CRITICAL RULES
**MANDATORY**: These rules MUST be followed before every commit.

### Secret Protection (MANDATORY):
- **NEVER** commit files containing:
  - API keys, tokens, passwords, secrets
  - `.env` files (any variant)
  - `mcp_config.json` (contains tokens)
  - Any config file with credentials
  - `*.secret`, `*.key`, `*.token` files
- **ALWAYS** use `.env` files for secrets (must be in `.gitignore`)
- **ALWAYS** create `.example` templates for config files
- **ALWAYS** check `.gitignore` before committing
- **ALWAYS** verify no secrets in `git diff` before committing

### Pre-Commit Security Checklist (MANDATORY):
Before EVERY commit, verify:
- [ ] No `.env` files in commit (`git status` should not show .env)
- [ ] No `mcp_config.json` in commit (use `.example` instead)
- [ ] No tokens/keys in code or config files
- [ ] `.gitignore` includes all sensitive files
- [ ] No secrets visible in `git diff`
- [ ] Example/template files don't contain real values

### Code Security:
- Validate all user inputs using sanitize.js
- Sanitize responses before sending to frontend
- Rate limit API endpoints (20 requests per 15 minutes)
- Use security headers (Helmet.js)
- Validate message length (max 2000 characters)
- Never log sensitive data (tokens, passwords, API keys)

### If Secret Exposed:
1. **IMMEDIATELY** revoke/regenerate the exposed secret
2. Remove file from git: `git rm --cached filename`
3. Add to `.gitignore`
4. Commit removal
5. Document incident
6. Update security guidelines

## Testing
- All tests in `Maya/tests/` directory
- Run tests before committing: `cd Maya/backend && npm test`
- Test response lengths (should be < 250 words)
- Test security measures (rate limiting, input validation)
- Test KB integration when implemented

## Documentation Review SOP (Janet's Docs Review SOP)

**Purpose**: Standard Operating Procedure for reviewing and maintaining documentation quality

**When to Use**: When reviewing, cross-checking, validating, or reviewing documentation, .md files, file naming conventions, or folder structure changes

**Command**: "run Janet's docs review SOP" = execute all 9 steps

### The 9-Step Process

#### 1. Review Criteria
- **Relevance**: Is it still current or outdated?
- **Overlaps**: Is content duplicated elsewhere?
- **Outdated Info**: References to removed files, old paths, unimplemented features?
- **Status**: Recommendation/plan not implemented? Historical snapshot? One-time task already done?

#### 2. Action Decision
- **Remove** if: Outdated recommendations, historical snapshots, completed one-time tasks, temporary analysis files
- **Update** if: Partially outdated but still relevant, has outdated references, needs date/path updates
- **Keep** if: Still relevant and provides unique value

#### 3. When Removing
- Capture historical essence in Implementation Timeline (`KB_MANAGEMENT_STRATEGY.md` or equivalent):
  - Date and purpose
  - What was planned/done
  - Why removed
  - Learnings
- Update `markdown-reference-integrity.test.js` (or equivalent test):
  - Add to `oldFiles` list
  - Add to `mergedFileMappings` (map to where content went)
  - Add to `excludedFiles` if it's a historical report

#### 4. When Updating
- Remove outdated references (e.g., S3, removed files)
- Update dates
- Update paths if structure changed
- Fix broken links
- Reflect current implementation

#### 5. Global Updates
- Update all references to removed files
- Update test tracking files
- Ensure no broken links
- Update dates where relevant

#### 6. Documentation Consolidation
- Merge overlapping content into consolidated files
- Categorize by topic/implementation timeline
- Remove redundant files
- Update all global references

#### 7. Cross-Reference Check & Test
- **Scope**: This SOP applies to **both files AND folders** naming conventions and structure changes
- Ensure no broken links
- Ensure no broken references
- **Run all relevant tests** (e.g., `markdown-reference-integrity.test.js`)
- **Special Attention for Folder Renaming**:
  - **Folder structure renaming requires EXTRA care** - impacts are broader than file renaming
  - **Comprehensive reference checking**: Update ALL references across the entire codebase:
    - Import/export statements in code files
    - Test file paths and test suite configurations
    - Documentation references (markdown links, code references)
    - Configuration files (package.json, jest.config.js, etc.)
    - Build scripts and deployment configurations
    - Any hardcoded paths or directory references
  - **Verify test coverage**: Ensure tests themselves are updated and still function correctly
  - **Cross-platform compatibility**: Verify paths work on different operating systems if applicable
- **If tests are failing**:
  1. **Document failures**: List all failing tests, error messages, and affected files
  2. **Identify root causes**: Analyze why tests are failing (broken references, missing files, incorrect paths, folder structure changes, etc.)
  3. **Apply fixes**: Fix broken references, update paths, add missing files, update folder references, or update test expectations
  4. **Test fixes**: Run the specific failing tests to verify fixes work
  5. **Run broader test suite**: Run all related tests to ensure no regressions
  6. **Iterate**: Repeat steps 1-5 until all tests pass
  7. **Document bug fixes**: Create a bug fix document with:
     - Root cause analysis
     - Fixes applied (files AND folders)
     - Tests added/modified
     - Test coverage impact
     - Traceability (which fixes address which failures)
  8. **Propose to user**: Present bug fix document for review:
     - Should fixes be added to existing tests or create new test strategies/files?
     - Are new tests increasing test coverage and robustness?
     - Is every step testable and bug fixes traceable?
- **Ensure testability**: Every step must be testable (applies to both file and folder changes)
- **Ensure traceability**: All bug fixes must be traceable to specific test failures (applies to both file and folder changes)
- **Ensure coverage**: New tests must increase test coverage and robustness (applies to both file and folder changes)

#### 8. Propose New Tests (If Needed)
- If removal/updates (files OR folders) might affect test coverage, propose new tests
- **For folder renaming**: Consider adding tests to verify folder structure integrity
- Justify why new tests are needed
- Don't assume removal/updates maintain test passing
- Propose before implementing
- **Tests apply to both files and folders**: Ensure test coverage includes path validation, import resolution, and reference integrity checks

#### 9. Review Generated Analysis Reports
- **After completing review and execution**, any generated `*_ANALYSIS*.md` or `*_REVIEW*.md` files should also be reviewed using this SOP
- These analysis files are typically temporary and will likely be removed after their purpose is fulfilled
- **Prompt the user**:
  - Inform them that an analysis report has been generated documenting what was implemented
  - Show the file path and brief summary of what it contains
  - Ask: **"Would you like to remove this analysis report?"**
- If user confirms removal:
  - Follow Steps 3-8 (capture historical essence, update tests, remove file, verify tests)
- If user wants to keep it:
  - Document why it's being kept (e.g., for future reference, unique value)
  - Ensure it's not in excludedFiles list if it should be checked by tests

**Example Prompt**:
```
ðŸ“‹ Analysis Report Generated

I've created an analysis report documenting the review and implementation:
- File: `knowledge/[ANALYSIS_REPORT_NAME].md`
- Content: [Brief description of what the report documents]
- Status: Historical essence already captured in KB_MANAGEMENT_STRATEGY.md

Would you like to remove this analysis report?
```

**Note**: 
- **GLOBAL APPLICATION**: This SOP applies to ALL future projects, not just the current one
- Always follow all 9 steps when reviewing documentation files
- When working on any project, use this SOP for all documentation review tasks
- Copy this section to other projects' `.cursorrules` files to ensure consistency
- **Step 7 Enhancement**: Includes comprehensive test validation, root cause analysis, iterative fixes, and bug fix documentation for user review

## File Organization
- Backend: `Maya/backend/`
- Frontend: `Maya/frontend/`
- Tests: `Maya/tests/`
- Knowledge Base: `Maya/knowledge/`
- Documentation: `Maya/*.md` files

## Common Tasks
- Restart server: `cd Maya/backend && ./stop.sh && ./start.sh`
- Test API: `curl -X POST http://localhost:3000/api/chat -H "Content-Type: application/json" -d '{"message": "Hello", "history": []}'`
- View logs: `tail -f Maya/backend/server.log`

## When Adding Features
- Update `Implementation.md` with changes
- Add tests for new functionality
- Update relevant `.md` documentation
- Test locally before deploying
- Consider security implications

## Pre-Deployment Checklist
- âœ… Run all tests: `cd Maya/backend && npm test`
- âœ… Run security tests: `npm run test:security`
- âœ… Verify `.cursorrules` are followed
- âœ… Check timezone/timestamps are correct
- âœ… Verify no sensitive data exposed
- âœ… Test locally before pushing
- âœ… Document changes in relevant `.md` files

## Important Reminders
- **ALWAYS** check system time before updating timestamps
- **ALWAYS** follow the 9-step Documentation Review SOP
- **ALWAYS** run tests before committing
- **NEVER** expose AI_BUILDER_TOKEN or sensitive data
- **NEVER** skip security checks
- **ALWAYS** verify DOM timing for frontend changes
- **ALWAYS** add defensive checks for DOM element access
- **NEVER** force push to main branch (use `git push` only)
- **ALWAYS** ensure tests pass before pushing to main

## Branch Protection
- Main branch should be protected (prevent force pushes and deletion)
- Status checks should be required before merging
- See `BRANCH_PROTECTION_SETUP.md` for setup instructions

